{% extends "base.html" %}
{% load static %}

{% block title %}Centre for Digital Learning (CDL) — Head Dashboard{% endblock %}

{% block head_extra %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'core/css/cdl_head_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="cdl-page">
  <!-- Simple page header (no duplicated user/profile/notifications) -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1>Centre for Digital Learning (CDL)</h1>
      <span class="header-date">{% now "F j, Y" %} • {% now "l" %}</span>
    </div>
  </header>

    <!-- KPI Cards -->
    <section class="kpi-section">
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-icon">
            <i class="fas fa-list-check"></i>
          </div>
          <div class="kpi-content">
            <span class="kpi-label">Total Active Requests</span>
            <span class="kpi-value" id="valActive">0</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon blue">
            <i class="fas fa-folder-open"></i>
          </div>
          <div class="kpi-content">
            <span class="kpi-label">Assets Delivery Pending</span>
            <span class="kpi-value" id="valAssetsPending">0</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon orange">
            <i class="fas fa-user-clock"></i>
          </div>
          <div class="kpi-content">
            <span class="kpi-label">Unassigned Tasks</span>
            <span class="kpi-value" id="valUnassigned">0</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon green">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="kpi-content">
            <span class="kpi-label">Total Events Supported</span>
            <span class="kpi-value" id="valEvents">0</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content Grid -->
    <section class="content-grid">
      <!-- Notifications Panel -->
      <div class="content-card notifications-panel">
        <div class="card-header">
          <h3><i class="fas fa-bell"></i> Notifications</h3>
          <div class="filter-tabs">
            <button class="tab-btn active" data-filter="all">All</button>
            <button class="tab-btn" data-filter="posters">Posters</button>
            <button class="tab-btn" data-filter="certificates">Certificates</button>
            <button class="tab-btn" data-filter="coverage">Coverage</button>
            <button class="tab-btn" data-filter="media">Media</button>
          </div>
        </div>
        <div class="card-content">
          <div class="notifications-list" id="eventDetailsList">
            <div class="empty-state">No notifications</div>
          </div>
        </div>
      </div>

      <!-- Workload Distribution Chart -->
      <div class="content-card chart-panel">
        <div class="card-header">
          <h3><i class="fas fa-chart-bar"></i> Workload Distribution</h3>
          <div class="chart-controls">
            <button class="control-btn active" data-view="workload">Workload</button>
            <button class="control-btn" data-view="ontime">On-time %</button>
            <button class="control-btn" data-view="firstpass">First-pass %</button>
            <div class="time-filter">
              <button class="time-btn" data-range="7">7d</button>
              <button class="time-btn active" data-range="30">30d</button>
              <button class="time-btn" data-range="90">90d</button>
            </div>
          </div>
        </div>
        <div class="card-content">
          <div class="chart-container">
            <canvas id="teamChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Calendar Panel -->
  <div class="content-card calendar-panel">
        <div class="card-header">
          <h3><i class="fas fa-calendar"></i> Calendar</h3>
          <div class="calendar-controls">
            <select id="calFilter" class="filter-select">
              <option value="all">All</option>
              <option value="support">Support</option>
            </select>
    <button class="add-btn" id="addEventBtn">
      <i class="fas fa-plus"></i> New Event
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="calendar-widget" id="miniCalendar">
            <div class="calendar-header">
              <button class="nav-btn" id="calPrev"><i class="fas fa-chevron-left"></i></button>
              <div class="calendar-title" id="calTitle">August 2025</div>
              <button class="nav-btn" id="calNext"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="calendar-weekdays">
              <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
            </div>
            <div class="calendar-grid" id="calGrid"></div>
          </div>
          <div class="calendar-legend">
            <div class="legend-item">
              <span class="legend-dot coverage"></span>
              <span>Coverage</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot approval"></span>
              <span>Approval</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot conflict"></span>
              <span>Conflict</span>
            </div>
          </div>
          <div class="calendar-details" id="upcomingWrap">
            <div class="empty-state">No items for 20/08/2025</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Assignment Manager -->
    <section class="assignment-manager">
      <div class="manager-header">
        <h3><i class="fas fa-tasks"></i> Assignment Manager</h3>
        <div class="manager-controls">
          <button class="control-btn active" data-filter="all">All</button>
          <button class="control-btn" data-filter="unassigned">Unassigned</button>
          <button class="control-btn" data-filter="urgent">Urgent</button>
          <div class="time-display">
            SLA: 3 - 24h
          </div>
        </div>
      </div>
      <div class="assignment-table">
        <table class="data-table">
          <thead>
            <tr>
              <th width="5%"><input type="checkbox" /></th>
              <th width="20%">Event</th>
              <th width="10%">Type</th>
              <th width="10%">Priority</th>
              <th width="15%">Due</th>
              <th width="15%">Assignee</th>
              <th width="10%">Status</th>
              <th width="10%">Rev</th>
              <th width="5%">Actions</th>
            </tr>
          </thead>
          <tbody id="taskList">
            <tr>
              <td colspan="9" class="empty-row">No items</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

<!-- Data is loaded via AJAX; no inline JSON -->
{% endblock %}

{% block scripts_extra %}
<script src="{% static 'core/js/cdl_head_dashboard.js' %}"></script>
{% endblock %}
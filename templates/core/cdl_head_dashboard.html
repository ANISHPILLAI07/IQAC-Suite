{% extends "base.html" %}
{% load static %}

{% block title %}Centre for Digital Learning (CDL) — Head Dashboard{% endblock %}

{% block head_extra %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="ems-dashboard">
  <header class="topbar">
    <div>
      <h1>Centre for Digital Learning (CDL)</h1>
      <span class="topbar-date">{% now "F j, Y · l" %}</span>
    </div>
  </header>

    <!-- KPI Cards -->
    <section class="kpi-row">
      <button class="kpi-card" id="kpiActive">
        <div class="kpi-icon bg-indigo"><i class="fa-solid fa-list-check"></i></div>
        <div class="kpi-content">
          <span class="kpi-title">Total Active Requests</span>
          <span class="kpi-value" id="valActive">0</span>
        </div>
      </button>

      <button class="kpi-card" id="kpiAssets">
        <div class="kpi-icon bg-sky"><i class="fa-solid fa-folder-open"></i></div>
        <div class="kpi-content">
          <span class="kpi-title">Assets Delivery Pending</span>
          <span class="kpi-value" id="valAssetsPending">0</span>
        </div>
      </button>

      <button class="kpi-card" id="kpiUnassigned">
        <div class="kpi-icon bg-orange"><i class="fa-solid fa-user-clock"></i></div>
        <div class="kpi-content">
          <span class="kpi-title">Unassigned Tasks</span>
          <span class="kpi-value" id="valUnassigned">0</span>
        </div>
      </button>

      <button class="kpi-card" id="kpiEvents">
        <div class="kpi-icon bg-emerald"><i class="fa-solid fa-calendar-check"></i></div>
        <div class="kpi-content">
          <span class="kpi-title">Total Events Supported</span>
          <span class="kpi-value" id="valEvents">0</span>
        </div>
      </button>
    </section>

    <!-- Main Content Grid -->
  <main class="cdl-grid">
      <!-- Notifications Panel -->
      <section class="card eq" id="cardNotifications">
        <div class="card-header">
          <h3><i class="fas fa-bell"></i> Notifications</h3>
          <div class="header-actions">
            <div class="seg">
              <button class="seg-btn active tab-btn" data-filter="all">All</button>
              <button class="seg-btn tab-btn" data-filter="posters">Posters</button>
              <button class="seg-btn tab-btn" data-filter="certificates">Certificates</button>
              <button class="seg-btn tab-btn" data-filter="coverage">Coverage</button>
              <button class="seg-btn tab-btn" data-filter="media">Media</button>
            </div>
          </div>
        </div>
        <div class="list" id="eventDetailsList"><div class="empty">No notifications</div></div>
      </section>

      <!-- Workload Distribution Chart -->
      <section class="card eq" id="cardTeam">
        <div class="card-header">
          <h3><i class="fas fa-chart-bar"></i> Workload Distribution</h3>
          <div class="header-actions">
            <div class="seg">
              <button class="seg-btn control-btn active" data-view="workload">Workload</button>
              <button class="seg-btn control-btn" data-view="ontime">On-time %</button>
              <button class="seg-btn control-btn" data-view="firstpass">First-pass %</button>
            </div>
            <div class="seg">
              <button class="seg-btn time-btn" data-range="7">7d</button>
              <button class="seg-btn time-btn active" data-range="30">30d</button>
              <button class="seg-btn time-btn" data-range="90">90d</button>
            </div>
          </div>
        </div>
        <div class="chart-wrap"><canvas id="teamChart" height="150"></canvas></div>
      </section>

      <!-- Calendar Panel -->
      <section class="card eq" id="cardCalendar">
        <div class="card-header">
          <h3><i class="fa-regular fa-calendar"></i> Calendar</h3>
          <div class="header-actions">
            <select id="calFilter" class="select">
              <option value="all">All</option>
              <option value="support">Support</option>
            </select>
            <a href="#" class="chip-btn" id="addEventBtn"><i class="fa-solid fa-plus"></i> New Event</a>
          </div>
        </div>
        <div class="mini-cal" id="miniCalendar">
          <div class="cal-head">
            <button class="cal-nav" id="calPrev" aria-label="Prev"><i class="fa-solid fa-chevron-left"></i></button>
            <div id="calTitle"></div>
            <button class="cal-nav" id="calNext" aria-label="Next"><i class="fa-solid fa-chevron-right"></i></button>
          </div>
          <div class="cal-weekdays"><span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span></div>
          <div class="cal-grid" id="calGrid"></div>
        </div>
      </section>

      <!-- Event Details Card (populated by calendar click) -->
      <section class="card eq" id="cardEventDetails">
        <div class="card-header">
          <h3><i class="fa-regular fa-calendar-days"></i> Event Details</h3>
          <button class="chip-btn" id="clearEventDetails" style="display:none"><i class="fa-solid fa-times"></i> Clear</button>
        </div>
        <div id="eventDetailsContent" class="event-details-content">
          <div class="empty">Select a date in the calendar to view events</div>
        </div>
      </section>
    </main>

    <!-- Assignment Manager -->
    <section class="card" id="cardAssignAll">
      <div class="card-header">
        <h3><i class="fa-solid fa-users-gear"></i> Assignment Manager</h3>
        <div class="header-actions">
          <div class="seg">
            <button class="seg-btn control-btn active" data-filter="all">All</button>
            <button class="seg-btn control-btn" data-filter="unassigned">Unassigned</button>
            <button class="seg-btn control-btn" data-filter="urgent">Urgent</button>
          </div>
          <span class="link-muted" style="font-size:12px;">SLA: 3 – 24h</span>
        </div>
      </div>
      <div class="table-wrap">
        <table class="table compact">
          <thead>
            <tr>
              <th><input type="checkbox" /></th>
              <th>Event</th>
              <th>Type</th>
              <th>Priority</th>
              <th>Due</th>
              <th>Assignee</th>
              <th>Status</th>
              <th>Rev</th>
              <th class="ta-right">Actions</th>
            </tr>
          </thead>
          <tbody id="taskList">
            <tr><td colspan="9" class="empty-row">No items</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

<!-- Data is loaded via AJAX; no inline JSON -->
{% endblock %}

{% block scripts_extra %}
<script src="{% static 'core/js/cdl_head_dashboard.js' %}"></script>
{% endblock %}
{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile - Student Dashboard{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'core/css/profile.css' %}">
<link rel="stylesheet" href="{% static 'core/css/student_dashboard.css' %}">

<div class="dashboard-profile-container">
  <!-- Navigation Bar -->
  <div class="dashboard-nav-bar">
    <div class="nav-left">
      <a href="{% url 'dashboard' %}" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Dashboard</span>
      </a>
    </div>
    <div class="nav-center">
      <h1 class="nav-title">My Profile</h1>
    </div>
    <div class="nav-right">
      <span class="user-badge student-badge">
        <i class="fas fa-user-graduate"></i>
        Student
      </span>
    </div>
  </div>

  <!-- Profile Header -->
  <div class="profile-header-section student-header">
    <div class="profile-header-container">
      <div class="profile-left-section">
        <div class="profile-avatar-section">
          <div class="profile-avatar-large student-avatar">
            <div class="avatar-placeholder">{{ user.get_full_name|default:user.username|slice:":1"|upper }}</div>
          </div>
          <button class="avatar-edit-btn">
            <i class="fas fa-camera"></i>
          </button>
        </div>
        <div class="profile-basic-info">
          <h1 class="profile-title">{{ user.get_full_name|default:user.username }}</h1>
          <p class="profile-subtitle">{{ user.email }}</p>
          {% if registration_number %}
          <p class="profile-reg-number">
            <i class="fas fa-id-card"></i>
            Registration: {{ registration_number }}
          </p>
          {% endif %}
          <div class="profile-completion-section">
            <div class="completion-label">Profile Completion</div>
            <div class="completion-bar-container">
              <div class="completion-bar">
                <div class="completion-fill" style="width: {{ profile_completion_percentage }}%"></div>
              </div>
              <span class="completion-percentage">{{ profile_completion_percentage }}%</span>
            </div>
          </div>
        </div>
      </div>
      <div class="profile-stats-section">
        <div class="profile-stats-grid student-stats">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ total_events|default:"0" }}</div>
              <div class="stat-label">EVENTS PARTICIPATED</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-building"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ org_count|default:"0" }}</div>
              <div class="stat-label">ORGANIZATIONS</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ user_achievements|length|default:"0" }}</div>
              <div class="stat-label">ACHIEVEMENTS</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ years_active|default:"0" }}</div>
              <div class="stat-label">YEARS ACTIVE</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="profile-tabs-section">
    <div class="profile-tabs-container">
      <nav class="profile-tabs-nav">
        <button class="tab-btn active" onclick="showTab('academic-info')">
          <i class="fas fa-graduation-cap"></i>
          <span>Academic Info</span>
        </button>
        <button class="tab-btn" onclick="showTab('participation')">
          <i class="fas fa-calendar-alt"></i>
          <span>Event Participation</span>
        </button>
        <button class="tab-btn" onclick="showTab('achievements')">
          <i class="fas fa-trophy"></i>
          <span>Achievements</span>
        </button>
        <button class="tab-btn" onclick="showTab('organizations')">
          <i class="fas fa-users-cog"></i>
          <span>Organizations</span>
        </button>
      </nav>
    </div>
  </div>

  <!-- Content Section -->
  <div class="profile-content-section">
    <!-- Academic Info Tab -->
    <div id="academic-info" class="tab-content-panel active">
      <div class="content-row">
        <!-- Personal Information -->
        <div class="content-card large-card">
          <div class="card-header">
            <div class="header-left">
              <div class="header-icon">
                <i class="fas fa-user"></i>
              </div>
              <h2>Personal Information</h2>
            </div>
            <button class="edit-btn" onclick="editPersonalInfo()">
              <i class="fas fa-edit"></i>
            </button>
          </div>
          <div class="card-body">
            <div class="info-grid-expanded">
              <div class="info-section">
                <div class="info-item-large">
                  <div class="info-label">
                    <i class="fas fa-user"></i>
                    <span>Full Name</span>
                  </div>
                  <div class="info-value">{{ user.get_full_name|default:"Not Set" }}</div>
                </div>
                <div class="info-item-large">
                  <div class="info-label">
                    <i class="fas fa-at"></i>
                    <span>Email</span>
                  </div>
                  <div class="info-value">{{ user.email|default:"Not Set" }}</div>
                </div>
              </div>
              <div class="info-section">
                <div class="info-item-large">
                  <div class="info-label">
                    <i class="fas fa-id-card"></i>
                    <span>Registration Number</span>
                  </div>
                  <div class="info-value">{{ registration_number|default:"Not Set" }}</div>
                </div>
                <div class="info-item-large">
                  <div class="info-label">
                    <i class="fas fa-calendar-plus"></i>
                    <span>Date Joined</span>
                  </div>
                  <div class="info-value">{{ user.date_joined|date:"F d, Y"|default:"Unknown" }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Academic Details -->
        <div class="content-card medium-card">
          <div class="card-header">
            <div class="header-left">
              <div class="header-icon">
                <i class="fas fa-graduation-cap"></i>
              </div>
              <h2>Academic Details</h2>
            </div>
            <button class="edit-btn" onclick="editAcademicInfo()">
              <i class="fas fa-edit"></i>
            </button>
          </div>
          <div class="card-body">
            <div class="status-list-compact">
              <div class="status-item-large">
                <div class="status-indicator academic">
                  <i class="fas fa-building-columns"></i>
                </div>
                <div class="status-content">
                  <div class="status-title">Department</div>
                  <div class="status-description">{{ department|default:"Not Assigned" }}</div>
                </div>
              </div>
              <div class="status-item-large">
                <div class="status-indicator academic">
                  <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="status-content">
                  <div class="status-title">Academic Year</div>
                  <div class="status-description">{{ academic_year|default:"Not Set" }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Participation Tab -->
    <div id="participation" class="tab-content-panel">
      <div class="content-row">
        <div class="content-card full-width-card">
          <div class="card-header">
            <div class="header-left">
              <div class="header-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <h2>Event Participation History</h2>
            </div>
            <div class="header-actions">
              <button class="btn btn-secondary" onclick="exportParticipation()">
                <i class="fas fa-download"></i>
                Export History
              </button>
            </div>
          </div>
          <div class="card-body full-height">
            {% if participated_events %}
              <div class="events-grid-expanded">
                {% for event in participated_events %}
                <div class="event-card-large">
                  <div class="event-header">
                    <div class="event-icon">
                      <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="event-info">
                      <h4>{{ event.event_title }}</h4>
                      <div class="event-meta">
                        {% if event.event_datetime %}
                        <span class="meta-item">
                          <i class="fas fa-clock"></i>
                          {{ event.event_datetime|date:"M d, Y" }}
                        </span>
                        {% endif %}
                        {% if event.venue %}
                        <span class="meta-item">
                          <i class="fas fa-map-marker-alt"></i>
                          {{ event.venue }}
                        </span>
                        {% endif %}
                      </div>
                    </div>
                    <div class="event-status">
                      <span class="status-badge status-{{ event.status }}">
                        {{ event.get_status_display }}
                      </span>
                    </div>
                  </div>
                  {% if event.description %}
                  <div class="event-description">
                    {{ event.description|truncatewords:20 }}
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="empty-state-expanded">
                <div class="empty-icon">
                  <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="empty-content">
                  <h3>No Event Participation Yet</h3>
                  <p>You haven't participated in any events yet. Start by exploring upcoming events and joining activities that interest you.</p>
                  <a href="{% url 'dashboard' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-search"></i>
                    <span>Browse Events</span>
                  </a>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Achievements Tab -->
    <div id="achievements" class="tab-content-panel">
      <div class="content-row">
        <div class="content-card full-width-card">
          <div class="card-header">
            <div class="header-left">
              <div class="header-icon">
                <i class="fas fa-trophy"></i>
              </div>
              <h2>My Achievements</h2>
            </div>
            <button class="btn btn-primary" onclick="addAchievement()">
              <i class="fas fa-plus"></i>
              <span>Add Achievement</span>
            </button>
          </div>
          <div class="card-body full-height">
            {% if user_achievements %}
              <div class="achievements-grid-expanded">
                {% for achievement in user_achievements %}
                <div class="achievement-card-large">
                  <div class="achievement-header">
                    <div class="achievement-icon">
                      <i class="fas fa-trophy"></i>
                    </div>
                    <div class="achievement-actions">
                      <button class="action-btn" onclick="editAchievement({{ achievement.id }})">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="action-btn" onclick="deleteAchievement({{ achievement.id }})">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <div class="achievement-content">
                    <h4>{{ achievement.title }}</h4>
                    <div class="achievement-meta">
                      <div class="meta-item">
                        <i class="fas fa-calendar"></i>
                        <span>{{ achievement.date_achieved|date:"M d, Y" }}</span>
                      </div>
                      <div class="meta-item">
                        <i class="fas fa-building"></i>
                        <span>{{ achievement.issuing_organization }}</span>
                      </div>
                    </div>
                    {% if achievement.description %}
                    <div class="achievement-description">
                      {{ achievement.description }}
                    </div>
                    {% endif %}
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="empty-state-expanded">
                <div class="empty-icon">
                  <i class="fas fa-trophy"></i>
                </div>
                <div class="empty-content">
                  <h3>No Achievements Yet</h3>
                  <p>Start building your achievement portfolio by adding your accomplishments and recognitions. Showcase your awards, certifications, and professional milestones.</p>
                  <button class="btn btn-primary btn-lg" onclick="addAchievement()">
                    <i class="fas fa-plus"></i>
                    <span>Add Your First Achievement</span>
                  </button>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Organizations Tab -->
    <div id="organizations" class="tab-content-panel">
      <div class="content-row">
        <div class="content-card full-width-card">
          <div class="card-header">
            <div class="header-left">
              <div class="header-icon">
                <i class="fas fa-users-cog"></i>
              </div>
              <h2>My Organizations</h2>
            </div>
            <button class="btn btn-primary" onclick="joinOrganization()">
              <i class="fas fa-plus"></i>
              <span>Join Organization</span>
            </button>
          </div>
          <div class="card-body full-height">
            {% if user_organizations %}
              <div class="organizations-grid-expanded">
                {% for org in user_organizations %}
                <div class="organization-card-large">
                  <div class="org-header">
                    <div class="org-icon">
                      <i class="fas fa-building"></i>
                    </div>
                    <div class="org-info">
                      <h4>{{ org.name }}</h4>
                      <div class="org-badge">{{ org.org_type.name }}</div>
                    </div>
                    <div class="org-actions">
                      <button class="action-btn" onclick="viewOrganization({{ org.id }})">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="action-btn" onclick="leaveOrganization({{ org.id }})">
                        <i class="fas fa-sign-out-alt"></i>
                      </button>
                    </div>
                  </div>
                  <div class="org-details">
                    <div class="detail-item">
                      <i class="fas fa-user-tag"></i>
                      <span>Member</span>
                    </div>
                    {% if org.joined_date %}
                    <div class="detail-item">
                      <i class="fas fa-calendar-plus"></i>
                      <span>Joined {{ org.joined_date|date:"M Y" }}</span>
                    </div>
                    {% endif %}
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="empty-state-expanded">
                <div class="empty-icon">
                  <i class="fas fa-users-cog"></i>
                </div>
                <div class="empty-content">
                  <h3>No Organizations</h3>
                  <p>You are not currently associated with any organizations. Join organizations to collaborate and contribute to meaningful projects and initiatives.</p>
                  <button class="btn btn-primary btn-lg" onclick="joinOrganization()">
                    <i class="fas fa-plus"></i>
                    <span>Join Your First Organization</span>
                  </button>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'core/js/profile.js' %}"></script>
<script src="{% static 'core/js/student_profile.js' %}"></script>
{% endblock %}

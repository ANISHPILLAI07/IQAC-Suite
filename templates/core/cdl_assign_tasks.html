{% extends "base.html" %}
{% load static %}

{% block title %}CDL — Assign Tasks{% endblock %}

{% block head_extra %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
<style>
  .assign-wrap{max-width:1100px;margin:0 auto}
  .assign-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .assign-table{width:100%;border-collapse:separate;border-spacing:0;}
  .assign-table th,.assign-table td{padding:10px 12px;border-bottom:1px solid var(--border);}
  .assign-table th{font-weight:600;color:var(--muted);text-align:left;background:var(--surf)}
  .assign-actions{display:flex;gap:8px;align-items:center}
  .row-del{color:#991b1b}
  .inline-input{width:100%;padding:8px;border:1px solid var(--border);border-radius:8px}
  .select{width:100%}
  .note{font-size:12px;color:var(--muted)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#4f46e5;font-size:12px}
  @media (max-width: 768px){ .assign-table th:nth-child(3), .assign-table td:nth-child(3){display:none} }
</style>
{% endblock %}

{% block content %}
<div class="ems-dashboard" id="cdl-assign-page" data-employee-mode="{% if employee_mode %}1{% else %}0{% endif %}" data-event-id="{{ proposal_id }}">
  <div class="assign-wrap">
    <header class="topbar" style="margin-bottom:12px">
      <div>
  <h1>CDL — Assign Tasks</h1>
  {% if employee_mode %}
  <div class="note" style="margin-top:4px">Employee view: you can update the status of tasks assigned to you. Assignment and task creation are disabled.</div>
  {% endif %}
        <span class="topbar-date">{% now "F j, Y · l" %}</span>
      </div>
      <div class="header-actions">
        <div class="seg" style="margin-right:8px">
          <input id="searchTasks" class="inline-input" placeholder="Filter by keyword…" style="width:260px" />
        </div>
  <a class="chip-btn" id="backBtn"><i class="fa-solid fa-arrow-left"></i> Back to Support</a>
  {% if employee_mode %}
  <button class="btn-primary" id="saveMyStatus"><i class="fa-solid fa-floppy-disk"></i> Save Status</button>
  {% endif %}
  {% if not employee_mode %}
  <button class="chip-btn" id="addCustom"><i class="fa-solid fa-plus"></i> Add Custom Task</button>
  <button class="btn-primary" id="saveAll"><i class="fa-solid fa-floppy-disk"></i> Save Changes</button>
  {% endif %}
      </div>
    </header>

    <section class="card" style="overflow:hidden;position:relative">
      <div class="card-header" style="position:sticky;top:0;background:#fff;z-index:2">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
          <h3 style="margin:0"><i class="fa-solid fa-table-columns"></i> Board</h3>
          <span class="note">Drag tasks between lanes to update status. Use the assignee dropdown (head only) to assign members.</span>
        </div>
        <div id="saveStatus" class="note" style="margin-left:auto"></div>
      </div>
  <div class="list" style="padding:4px 6px 10px 6px">
        <div id="board" class="board"></div>
      </div>
    </section>
  </div>
</div>

<div id="toast" style="position:fixed;right:16px;top:84px;z-index:1000;display:none;background:#164c8d;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 12px 40px rgba(2,6,23,.2);font-weight:700"></div>

{% endblock %}

{% block scripts_extra %}
<script src="{% static 'core/js/cdl_assign_tasks.js' %}"></script>
{% endblock %}

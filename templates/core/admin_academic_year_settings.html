{% extends "base.html" %}
{% load static %}

{% block title %}Academic Year Settings â€“ Event Management Suite{% endblock %}

{% block head_extra %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'core/css/admin_academic_year.css' %}">
{% endblock %}

{% block content %}
<div class="main-container">
  
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-header-content">
      <div class="breadcrumb">
        <a href="{% url 'admin_dashboard' %}"><i class="fas fa-home"></i> Admin Dashboard</a>
        <span class="breadcrumb-separator">></span>
        <span>Academic Year Settings</span>
      </div>
      <h1><i class="fas fa-calendar-alt"></i> Academic Year Settings</h1>
      <p class="page-description">Manage academic year configurations for the system</p>
    </div>
  </div>

  <div class="content-grid">
    
    <!-- Add/Edit Academic Year Form -->
    <div class="card form-card">
      <div class="card-header">
        <h3><i class="fas fa-plus-circle"></i> {% if edit_year %}Edit Academic Year{% else %}Add New Academic Year{% endif %}</h3>
      </div>
      <div class="card-body">
        <form method="post" class="academic-year-form">
          {% csrf_token %}
          {% if edit_year %}
          <input type="hidden" name="id" value="{{ edit_year.id }}">
          {% endif %}
          
          <div class="form-grid">
            <div class="form-group">
              <label for="startDate" class="form-label">
                <i class="fas fa-calendar-day"></i> Start Date
              </label>
              <input type="date" 
                     id="startDate" 
                     name="start_date" 
                     class="form-control" 
                     value="{{ edit_year.start_date|date:'Y-m-d' }}"
                     required>
            </div>
            
            <div class="form-group">
              <label for="endDate" class="form-label">
                <i class="fas fa-calendar-day"></i> End Date
              </label>
              <input type="date" 
                     id="endDate" 
                     name="end_date" 
                     class="form-control" 
                     value="{{ edit_year.end_date|date:'Y-m-d' }}"
                     required>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              {% if edit_year %}Update Academic Year{% else %}Add Academic Year{% endif %}
            </button>
            {% if edit_year %}
            <a href="{% url 'admin_academic_year_settings' %}" class="btn btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </a>
            {% endif %}
          </div>
        </form>
      </div>
    </div>

    <!-- Active Academic Years -->
    <div class="card years-card">
      <div class="card-header">
        <h3><i class="fas fa-calendar-check"></i> Active Academic Years</h3>
        <div class="card-header-actions">
          <span class="badge badge-info">{{ active_years|length }} Active</span>
        </div>
      </div>
      <div class="card-body">
        {% if active_years %}
        <div class="years-list">
          {% for year in active_years %}
          <div class="year-item active">
            <div class="year-info">
              <div class="year-title">{{ year.year }}</div>
              <div class="year-dates">
                <span class="date-range">
                  <i class="fas fa-calendar"></i>
                  {{ year.start_date|date:"M d, Y" }} - {{ year.end_date|date:"M d, Y" }}
                </span>
              </div>
            </div>
            <div class="year-actions">
              <a href="?edit={{ year.id }}" class="btn btn-sm btn-outline-primary" title="Edit">
                <i class="fas fa-edit"></i> Edit
              </a>
              <form method="post" action="{% url 'academic_year_archive' year.id %}" style="display:inline;" 
                    onsubmit="return confirm('Are you sure you want to archive this academic year?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-warning" title="Archive">
                  <i class="fas fa-archive"></i> Archive
                </button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
          <div class="empty-icon"><i class="fas fa-calendar-times"></i></div>
          <h4>No Active Academic Years</h4>
          <p>Add your first academic year to get started.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Archived Academic Years -->
    <div class="card archived-card">
      <div class="card-header collapsible" data-toggle="collapse" data-target="#archivedYears">
        <h3><i class="fas fa-archive"></i> Archived Academic Years</h3>
        <div class="card-header-actions">
          <span class="badge badge-secondary">{{ archived_years|length }} Archived</span>
          <i class="fas fa-chevron-down collapse-icon"></i>
        </div>
      </div>
      <div class="card-body collapse" id="archivedYears">
        {% if archived_years %}
        <div class="years-list">
          {% for year in archived_years %}
          <div class="year-item archived">
            <div class="year-info">
              <div class="year-title">{{ year.year }}</div>
              <div class="year-dates">
                <span class="date-range">
                  <i class="fas fa-calendar"></i>
                  {{ year.start_date|date:"M d, Y" }} - {{ year.end_date|date:"M d, Y" }}
                </span>
                <span class="archived-badge">
                  <i class="fas fa-archive"></i> Archived
                </span>
              </div>
            </div>
            <div class="year-actions">
              <form method="post" action="{% url 'academic_year_restore' year.id %}" style="display:inline;"
                    onsubmit="return confirm('Are you sure you want to restore this academic year?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-success" title="Restore">
                  <i class="fas fa-undo"></i> Restore
                </button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="empty-state small">
          <div class="empty-icon"><i class="fas fa-archive"></i></div>
          <p>No archived academic years.</p>
        </div>
        {% endif %}
      </div>
    </div>
    
  </div>
</div>

<script>
// Collapsible functionality
document.addEventListener('DOMContentLoaded', function() {
  const collapsibleHeaders = document.querySelectorAll('.collapsible');
  
  collapsibleHeaders.forEach(header => {
    header.addEventListener('click', function() {
      const target = document.querySelector(this.dataset.target);
      const icon = this.querySelector('.collapse-icon');
      
      if (target.classList.contains('show')) {
        target.classList.remove('show');
        icon.style.transform = 'rotate(0deg)';
      } else {
        target.classList.add('show');
        icon.style.transform = 'rotate(180deg)';
      }
    });
  });
});
</script>
{% endblock %}

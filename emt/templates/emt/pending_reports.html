{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'emt/css/iqac_pending_reports.css' %}">

<div class="iqac-dashboard-bg">
  <div class="iqac-dashboard-container">
    <!-- Header Section -->
    <div class="iqac-page-header">
      <div class="iqac-header-content">
        <div class="iqac-header-icon">
          <span class="iqac-section-emoji">ðŸ“‘</span>
        </div>
        <div class="iqac-header-text">
          <h1 class="iqac-page-title">IQAC Reports</h1>
          <p class="iqac-page-subtitle">Proposals Pending Report Generation</p>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="iqac-table-container">
      {% if proposals %}
        <div class="iqac-table-wrapper">
          <table class="iqac-reports-table">
            <thead>
              <tr>
                <th class="iqac-th-icon"></th>
                <th class="iqac-th-title">Event Title</th>
                <th class="iqac-th-status">Status</th>
                <th class="iqac-th-actions">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for proposal in proposals %}
                <tr class="iqac-table-row">
                  <td class="iqac-td-icon">
                    <div class="iqac-doc-icon">
                      <svg width="32" height="40" viewBox="0 0 32 40" fill="none">
                        <rect width="32" height="40" rx="7" fill="#2A4B8D" fill-opacity="0.12"/>
                        <rect x="5" y="8" width="22" height="24" rx="3" fill="#2A4B8D" />
                        <rect x="8.5" y="13.5" width="15" height="2" rx="1" fill="#fff"/>
                        <rect x="8.5" y="18.5" width="11" height="2" rx="1" fill="#fff"/>
                      </svg>
                    </div>
                  </td>
                  <td class="iqac-td-title">
                    <div class="iqac-event-info">
                      <div class="iqac-event-title">{{ proposal.event_title|default:"(Untitled Event)" }}</div>
                    </div>
                  </td>
                  <td class="iqac-td-status">
                    {% if proposal.report_assigned_to %}
                      <span class="iqac-status-badge assigned">Assigned to {{ proposal.report_assigned_to.get_full_name }}</span>
                    {% else %}
                      <span class="iqac-status-badge">Submitted by you</span>
                    {% endif %}
                  </td>
                  <td class="iqac-td-actions">
                    <div class="iqac-action-buttons">
                      <a href="{% url 'emt:submit_event_report' proposal.id %}" class="iqac-generate-btn">Generate Report</a>
                      <button class="iqac-assign-btn" data-proposal-id="{{ proposal.id }}" data-event-title="{{ proposal.event_title }}">
                        {% if proposal.report_assigned_to %}
                          Reassign
                        {% else %}
                          Assign to
                        {% endif %}
                      </button>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="iqac-empty-state">
          <div class="iqac-empty-icon">ðŸŽ‰</div>
          <div class="iqac-empty-msg">No pending proposals.<br>All your reports are ready!</div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Assignment Modal -->
<div id="assignModal" class="assign-modal" style="display: none;">
  <div class="assign-modal-content">
    <div class="assign-modal-header">
      <h3>Assign Report Generation</h3>
      <span class="assign-modal-close">&times;</span>
    </div>
    <div class="assign-modal-body">
      <p id="assignEventTitle"></p>
      
      <div class="assign-search-section">
        <label for="participantSearch">Search Participants:</label>
        <input type="text" id="participantSearch" placeholder="Type name, email, or username..." />
        <div class="search-help">Only event participants (submitter and faculty incharges) can be assigned.</div>
      </div>
      
      <div id="participantsList" class="participants-list">
        <!-- Participants will be loaded here -->
      </div>
      
      <div id="selectedParticipant" class="selected-participant" style="display: none;">
        <h4>Selected Participant:</h4>
        <div class="participant-card selected">
          <div class="participant-info">
            <span class="participant-name" id="selectedName"></span>
            <span class="participant-role" id="selectedRole"></span>
            <span class="participant-email" id="selectedEmail"></span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="assign-modal-footer">
      <button id="confirmAssignBtn" class="btn-assign-confirm" disabled>Confirm Assignment</button>
      <button id="cancelAssignBtn" class="btn-assign-cancel">Cancel</button>
      <button id="unassignBtn" class="btn-unassign" style="display: none;">Remove Assignment</button>
    </div>
  </div>
</div>

<script src="{% static 'emt/js/pending_reports_assignment.js' %}"></script>
{% endblock %}
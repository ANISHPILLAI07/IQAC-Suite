{% extends "base.html" %}
{% load static %}

{% block title %}CDL Post-Event{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'emt/css/styles.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="header">
    <h1>Post-Event CDL Processing for "{{ proposal.event_title }}"</h1>
  </div>
  <div class="page-content">
    <div class="section">
      <h2>Certificate Recipients</h2>
      <form method="post">
        {% csrf_token %}
        {{ recipient_form.as_p }}
        <button type="submit" name="add_recipient" class="btn btn-submit">Add Recipient</button>
      </form>
      <ul>
        {% for r in recipients %}
          <li>{{ r.name }} â€” {{ r.get_certificate_type_display }} {% if r.ai_approved %}(Approved){% else %}(Pending){% endif %}</li>
        {% empty %}
          <li>No recipients added.</li>
        {% endfor %}
      </ul>
    </div>
    <div class="section">
      <h2>CDL Communication</h2>
      <div class="messages">
        {% for m in messages %}
          <div class="message"><strong>{{ m.sender.get_full_name|default:m.sender.username }}</strong>: {{ m.message }} <span class="timestamp">{{ m.created_at|date:"M d, Y H:i" }}</span>{% if m.file %} <a href="{{ m.file.url }}">File</a>{% endif %}</div>
        {% empty %}
          <p>No messages yet.</p>
        {% endfor %}
      </div>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ message_form.as_p }}
        <button type="submit" name="send_message" class="btn btn-submit">Send</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% extends "base.html" %}
{% load static %}

{% block head_extra %}
  <link rel="stylesheet" href="{% static 'emt/css/submit_event_report.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}

<div class="report-layout">
  <aside class="info-panel">
    <div class="info-card">
      <h2 class="panel-title">Event Info</h2>
      <table>
        <tr><th>Organization</th><td>{{ proposal.organization.name }}</td></tr>
        <tr><th>Title</th><td>{{ proposal.event_title }}</td></tr>
        <tr><th>Date & Time</th><td>{{ proposal.event_datetime|date:"d M Y, H:i" }}</td></tr>
        <tr><th>Venue</th><td>{{ proposal.venue }}</td></tr>
        <tr><th>Academic Year</th><td>{{ proposal.academic_year }}</td></tr>
        <tr><th>Focus</th><td>{{ proposal.event_focus_type }}</td></tr>
        <tr><th>Target Audience</th><td>{{ proposal.target_audience }}</td></tr>
      </table>
    </div>
    <nav class="stepper">
      <ol>
        <li class="active">Report Details</li>
        <li>Attachments</li>
        <li>Review &amp; Submit</li>
      </ol>
    </nav>
  </aside>

  <section class="form-wrapper">
    <div class="form-card">
      <h1 class="page-title">Generate Event Report</h1>
      <p class="form-meta">Fill the required fields and attach supporting documents.</p>
      <form method="post" enctype="multipart/form-data" class="event-report-form">
        {% csrf_token %}

        <div class="section">
          <h3 class="section-title">Report Details</h3>
          {{ form.non_field_errors }}
          <div class="form-grid">
            {% for field in form %}
              <div class="form-group">
                {{ field }}
                <label for="{{ field.id_for_label }}">{{ field.label }}{% if field.field.required %} *{% endif %}</label>
                {% if field.help_text %}<small class="help">{{ field.help_text }}</small>{% endif %}
                {{ field.errors }}
              </div>
            {% endfor %}
          </div>
        </div>

        <div class="section">
          <h3 class="section-title">Upload Attachments</h3>
          {{ formset.management_form }}
          <div class="attachment-row">
            {% for f in formset %}
              <div class="attachment-block">
                {{ f.file.label_tag }} {{ f.file }}
                {{ f.caption.label_tag }} {{ f.caption }}
                {% if f.instance.pk %}
                  <label>Delete:</label> {{ f.DELETE }}
                {% endif %}
              </div>
            {% endfor %}
          </div>
        </div>

        <div class="save-btn">
          <button type="submit">Save &amp; Generate</button>
        </div>
      </form>
    </div>
  </section>
</div>

<div id="outcomeModal" class="outcome-modal" data-url="{% url 'emt:api_outcomes' proposal.organization.id %}">
  <div class="modal-content">
    <h3>Select Outcomes</h3>
    <div id="outcomeOptions">Loading...</div>
    <div class="modal-actions">
      <button type="button" id="outcomeCancel" class="btn-cancel">Cancel</button>
      <button type="button" id="outcomeSave" class="btn-save">Add</button>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'emt/js/submit_event_report.js' %}"></script>
{% endblock %}


{% extends "base.html" %}
{% load static %}

{% block title %}Submit Event Proposal{% endblock %}

{% block head_extra %}
  <!-- your existing global styles -->
  <link rel="stylesheet" href="{% static 'emt/css/styles.css' %}">

  <!-- Typeahead core CSS -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.css"
    rel="stylesheet"
  />

  <!-- our custom inline-hint styling -->
  <link rel="stylesheet" href="{% static 'emt/css/typeahead-modern.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="header">
    <h1>Submit Your Event Proposal</h1>
    <p>Fill out the details below to register your event.</p>
  </div>

  <div class="page-content">
    <form method="post" enctype="multipart/form-data" class="proposal-form">
      {% csrf_token %}

      <div class="section">
        {% for field in form.visible_fields %}

          {# ─── Department uses our own Typeahead input ─── #}
          {% if field.name == 'department' %}
            <div class="input-group{% if field.errors %} has-error{% endif %}">
              <label for="department-input">{{ field.label }}</label>
              <input
                type="text"
                id="department-input"
                name="department"
                autocomplete="off"
                placeholder="Type to search…"
                value="{{ form.instance.department.name|default:'' }}"
                class="tt-query"
                data-url="{% url 'emt:api_departments' %}"
              />
              {% for error in field.errors %}
                <span class="error">{{ error }}</span>
              {% endfor %}
            </div>

          {# ─── Everything else stays as before ─── #}
          {% else %}
            {% if field.name == 'event_focus_type' %}
              <hr><h3>Event Focus & Participants</h3>
            {% elif field.name == 'fest_fee_participants' %}
              <hr><h3>Fest Income Details</h3>
            {% elif field.name == 'conf_fee_participants' %}
              <hr><h3>Conference Income Details</h3>
            {% endif %}
            <div class="input-group{% if field.errors %} has-error{% endif %}">
              {{ field.label_tag }}
              {{ field }}
              {% if field.help_text %}
                <small class="help-text">{{ field.help_text }}</small>
              {% endif %}
              {% for error in field.errors %}
                <span class="error">{{ error }}</span>
              {% endfor %}
            </div>
          {% endif %}

        {% endfor %}
      </div>

      <button type="submit" name="submit" class="btn btn-primary" style="margin-top:24px;">
        Save &amp; Continue
      </button>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js">
  </script>
  <script src="{% static 'emt/js/typeahead-init.js' %}"></script>
  <script>
    window.PROPOSAL_ID   = "{{ proposal.id|default:'' }}";
    window.AUTOSAVE_URL  = "{% url 'emt:autosave_proposal' %}";
    window.AUTOSAVE_CSRF = "{{ csrf_token }}";
  </script>
  {#<script src="{% static 'emt/js/autosave_draft.js' %}"></script>#}
{% endblock %}

{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'emt/css/iqac_suite_dashboard.css' %}">

<div class="suite-dashboard-container">
  <h1 class="suite-dashboard-title">IQAC Suite Dashboard</h1>
  <div class="suite-dashboard-body">

    <!-- LEFT: CARDS -->
    <div class="suite-left-section">
      <!-- Event Proposal -->
      <div class="suite-card suite-card-hover suite-glass">
        <div class="suite-card-icon suite-card-icon-blue">
          <!-- SVG ICON HERE -->
        </div>
        <div class="suite-card-title">Event Proposal</div>
        <div class="suite-card-desc">Create and manage event proposals</div>
        <a href="{% url 'emt:submit_proposal' %}" class="suite-card-btn">Go &rarr;</a>
      </div>

      <!-- IQAC Report Generation -->
      <div class="suite-card suite-card-hover suite-glass">
        <div class="suite-card-icon suite-card-icon-purple">
          <!-- SVG ICON HERE -->
        </div>
        <div class="suite-card-title">IQAC Report Generation</div>
        <div class="suite-card-desc">Generate IQAC reports</div>
        <a href="{% url 'emt:pending_reports' %}" class="suite-card-btn">Go &rarr;</a>
      </div>

      <!-- View Generated Reports -->
      <div class="suite-card suite-card-hover suite-glass">
        <div class="suite-card-icon suite-card-icon-green">
          <!-- SVG ICON HERE -->
        </div>
        <div class="suite-card-title">View Generated Reports</div>
        <div class="suite-card-desc">See all your generated reports</div>
        <a href="{% url 'emt:generated_reports' %}" class="suite-card-btn">Go &rarr;</a>
      </div>

      <!-- Event Approvals -->
      {% if user.is_authenticated and show_approvals_card %}
      <div class="suite-card suite-card-hover suite-glass">
        <div class="suite-card-icon suite-card-icon-orange">
          <!-- SVG ICON HERE -->
        </div>
        <div class="suite-card-title">Event Approvals</div>
        <div class="suite-card-desc">Review and approve event proposals</div>
        <a href="{% url 'emt:my_approvals' %}" class="suite-card-btn">Go &rarr;</a>
      </div>
      {% endif %}
    </div>

    <!-- RIGHT: NOTIFICATIONS -->
    <div class="suite-right-section suite-glass">
      <div class="notif-heading">Notifications</div>
      <div class="notif-box">
        {% if user_proposals %}
          <ul class="notif-list">
            {% for proposal in user_proposals %}
              <li class="notif-item animate-fade-in">
                <div class="notif-row">
                  <span class="notif-event-title">{{ proposal.event_title }}</span>
                  {% if proposal.status == 'submitted' %}
                    <span class="notif-status notif-status-pending">Submitted</span>
                  {% elif proposal.status == 'under_review' %}
                    <span class="notif-status notif-status-review">Under Review</span>
                  {% elif proposal.status == 'rejected' %}
                    <span class="notif-status notif-status-rejected">Rejected</span>
                  {% elif proposal.status == 'returned' %}
                    <span class="notif-status notif-status-feedback">Returned</span>
                  {% endif %}
                </div>
                {% if proposal.return_comment %}
                  <div class="notif-feedback"><b>Feedback:</b> {{ proposal.return_comment }}</div>
                {% endif %}

                <!-- MODERN PROGRESS CHART -->
                <div class="workflow-progress">
                  <div class="progress-steps">
                    {% for status in statuses %}
                      <div class="progress-step">
                        <div class="progress-dot
                          {% if forloop.counter0 < proposal.status_index %}progress-dot-past{% endif %}
                          {% if forloop.counter0 == proposal.status_index %}progress-dot-current{% endif %}
                          {% if forloop.counter0 > proposal.status_index %}progress-dot-future{% endif %}
                        ">
                          {% if forloop.counter0 < proposal.status_index %}
                            <svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="5" fill="#22c55e"/><polyline points="4,6 6,8 9,4" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          {% elif forloop.counter0 == proposal.status_index %}
                            <svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="5" fill="#3b82f6"/></svg>
                          {% else %}
                            <svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="5" fill="#cbd5e1"/></svg>
                          {% endif %}
                        </div>
                        {% if not forloop.last %}
                          <div class="progress-step-line"></div>
                        {% endif %}
                        <div class="progress-step-label">
                          {{ status|capfirst }}
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                  <div class="progress-bar-container">
                    <div class="progress-bar-fill"
                      style="width: {{ proposal.progress_percent }}%;">
                    </div>
                  </div>
                  <span class="progress-bar-label">
                    {{ proposal.progress_percent }}% complete ({{ proposal.current_label }})
                  </span>
                </div>
                <!-- END CHART -->
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="notif-empty">
            <span>ðŸŽ‰ All clear! No proposals need your attention right now.</span>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}